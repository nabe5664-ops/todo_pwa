<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ToDo</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6366f1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<link rel="apple-touch-icon" sizes="180x180" href="icon-180-v2.png">
<link rel="icon" href="icon.svg" type="image/svg+xml">


  <!-- iOS: ホーム画面アイコン（PNG推奨） -->
<link rel="apple-touch-icon" sizes="180x180" href="icon-180-v2.png"> 


  <!-- ブラウザ用 -->
  <link rel="icon" href="icon.svg" type="image/svg+xml">

  <style>
    :root{
      --bg1:#f6f7fb;
      --bg2:#eef2ff;
      --card:#ffffffcc;
      --stroke:#e8e8ef;
      --text:#0f172a;
      --muted:#64748b;
      --accent:#6366f1;
      --accent2:#22c55e;
      --danger:#ef4444;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 20% 0%, var(--bg2), transparent 60%),
        radial-gradient(900px 600px at 100% 40%, #ffe4e6, transparent 55%),
        linear-gradient(180deg, var(--bg1), #ffffff);
      min-height:100vh;
    }

    .wrap{
      max-width:640px;
      margin:0 auto;
      padding:20px 16px 28px;
    }

    h1{
      margin:10px 0 14px;
      font-size:22px;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    h1:before{
      content:"";
      width:12px;height:12px;
      border-radius:999px;
      background:linear-gradient(135deg,var(--accent),#a78bfa);
      box-shadow:0 6px 18px rgba(99,102,241,.35);
    }

    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:14px;
      box-shadow:0 16px 50px rgba(2,6,23,.08);
      backdrop-filter: blur(10px);
    }

    .row{
      display:flex;
      gap:10px;
      align-items:center;
    }

    input{
      flex:1;
      font-size:16px;
      padding:12px 12px;
      border:1px solid var(--stroke);
      border-radius:14px;
      outline:none;
      background:#fff;
      transition:border-color .15s, box-shadow .15s;
    }
    input:focus{
      border-color:rgba(99,102,241,.55);
      box-shadow:0 0 0 4px rgba(99,102,241,.15);
    }

    button{
      padding:12px 14px;
      font-size:15px;
      border:none;
      border-radius:14px;
      color:#fff;
      background:linear-gradient(135deg,var(--accent),#8b5cf6);
      box-shadow:0 10px 24px rgba(99,102,241,.28);
      cursor:pointer;
      transition: transform .05s, filter .15s;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button:active{ transform: translateY(1px); }
    button:hover{ filter:brightness(1.03); }

    .mini{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }

    ul{
      list-style:none;
      padding:0;
      margin:12px 0 0;
      overflow:hidden;
      border-radius:14px;
      border:1px solid var(--stroke);
      background:#fff;
    }

li{
  display: grid;
  grid-template-columns: auto 1fr auto; /* 左：チェック / 中央：本文 / 右：削除 */
  align-items: flex-start;
  justify-items: start;   /* ← 中央寄りを完全に防ぐ決定打 */
  gap: 10px;

  padding: 12px 12px;
  border-bottom: 1px solid var(--stroke);
}

/* 中央コンテンツ（本文エリア） */
.content{
  width: 100%;
}

/* タイトル */
.title{
  display: block;
  width: 100%;
  text-align: left;
  white-space: pre-wrap;
  word-break: break-word;
  line-height: 1.5;

  background: transparent;
  border: none;
  padding: 0;
  margin: 0;
  color: var(--text);
}

 /* iOS対策：本文エリアを左端＆幅いっぱいに固定 */
.content{
  justify-self: stretch;
  width: 100%;
  min-width: 0;
  text-align: left !important;
}

.title,
.created{
  align-self: stretch;
  width: 100%;
  text-align: left !important;
}

li{
  text-align: left !important;
}
   
    


 /* タイトル（編集ボタン）を “テキスト” に見せる */
.title{
  flex: 1;
  width: 100%;          /* ← これが決定打 */
  display: block;       /* ← ボタン感を消す */

  font-size:16px;
  padding:0;
  margin:0;

  text-align: left;
  white-space: pre-wrap;
  word-break: break-word;
  line-height: 1.5;

  background: transparent;
  box-shadow: none;
  border-radius: 10px;
  color: var(--text);
}

    
    .title:hover{ filter:none; }
    .title:active{ transform:none; }
    .title:focus{
      outline:none;
      box-shadow:0 0 0 4px rgba(99,102,241,.12);
    }

    .done .title{
      color:#94a3b8;
      text-decoration:line-through;
    }

    .toggle{
      width:20px;height:20px;
      accent-color: var(--accent2);
    }

    .del{
      background:transparent;
      color:var(--danger);
      border:1px solid rgba(239,68,68,.25);
      box-shadow:none;
      padding:8px 10px;
      border-radius:12px;
      font-size:14px;
    }

/* 編集中input */
.editInput{
  flex:1;
  font-size:16px;
  padding:10px 10px;
  border:1px solid rgba(99,102,241,.35);
  border-radius:12px;
  outline:none;
  background:#fff;
  box-shadow:0 0 0 4px rgba(99,102,241,.12);
}

.content { 
  text-align: left; 
}

.created{
  display: block;
  text-align: left;
  font-size: 12px;
  color: var(--muted);
  margin-top: 6px;
}
.content{
  display: flex;
  flex-direction: column;
  align-items: flex-start;  /* ← 中身を左寄せ固定 */
}

.title,
.created{
  width: 100%;
  text-align: left;         /* ← 改行も左詰め */
}    

  </style>
</head>
 
<body>
  <div class="wrap">
    <h1>ToDo</h1>

    <div class="card">
      <div class="row">
        <input id="newTitle" placeholder="追加するToDo" autocomplete="off" />
        <button id="addBtn" type="button">追加</button>
      </div>

      <div class="mini">タイトルをタップで編集 / チェックで完了 / 削除で消去（端末内保存）</div>

      <ul id="list"></ul>
    </div>
  </div>

  <script>
    (function () {
      const STORAGE_KEY = "todo_pwa_items_v1";

      const input = document.getElementById("newTitle");
      const btn = document.getElementById("addBtn");
      const listEl = document.getElementById("list");

      let todos = [];

      function load() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          const parsed = raw ? JSON.parse(raw) : [];
          if (Array.isArray(parsed)) todos = parsed;
        } catch (e) {
          todos = [];
        }
      }

      function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
      }

      function escapeText(s) {
        return String(s).replace(/[&<>"']/g, (c) => ({
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#39;",
        }[c]));
      }

function render() {
  if (!todos.length) {
    listEl.innerHTML = '<li class="mini" style="border-bottom:none;">まだToDoがありません</li>';
    return;
  }

  listEl.innerHTML = todos.map(t => {
    const cls = t.done ? "done" : "";
    const created = t.createdAt ? new Date(t.createdAt).toLocaleString() : "";

    return `
      <li class="${cls}" data-id="${escapeText(t.id)}">
        <input
          class="toggle"
          type="checkbox"
          ${t.done ? "checked" : ""}
          aria-label="完了切替"
        />

        <div class="content">
          <button
            class="title edit"
            type="button"
            aria-label="タイトル編集"
          >
            ${escapeText(t.title)}
          </button>

          <small class="created">${escapeText(created)}</small>
        </div>

        <button class="del" type="button" aria-label="削除">削除</button>
      </li>
    `;
  }).join("");
}


      function add() {
        const title = input.value.trim();
        if (!title) return;

        const id = (window.crypto && crypto.randomUUID)
          ? crypto.randomUUID()
          : String(Date.now()) + "_" + Math.random().toString(16).slice(2);

        todos.unshift({ id, title, done: false, createdAt: Date.now() });
        save();
        render();

        input.value = "";
        input.focus();
      }

      function toggle(id, done) {
        const t = todos.find(x => x.id === id);
        if (!t) return;
        t.done = done;
        save();
        render();
      }

      function remove(id) {
        todos = todos.filter(x => x.id !== id);
        save();
        render();
      }

      btn.addEventListener("click", add);

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") add();
      });

      listEl.addEventListener("click", (e) => {
        const li = e.target.closest("li[data-id]");
        if (!li) return;
        const id = li.getAttribute("data-id");

        // タイトルタップで編集（インライン編集）
        if (e.target.classList.contains("edit")) {
          const current = todos.find(x => x.id === id);
          if (!current) return;

          const inputEl = document.createElement("input");
          inputEl.type = "text";
          inputEl.value = current.title;
          inputEl.className = "editInput";
          inputEl.setAttribute("aria-label", "ToDoタイトル編集");

          e.target.replaceWith(inputEl);
          inputEl.focus();
          inputEl.setSelectionRange(inputEl.value.length, inputEl.value.length);

          const finish = () => {
            const next = inputEl.value.trim();
            if (next) {
              current.title = next;
              save();
            }
            render();
          };

          inputEl.addEventListener("blur", finish, { once: true });
          inputEl.addEventListener("keydown", (ev) => {
            if (ev.key === "Enter") finish();
            if (ev.key === "Escape") render(); // キャンセル
          });

          return;
        }

        // 削除
        if (e.target.classList.contains("del")) {
          remove(id);
          return;
        }
      });

      listEl.addEventListener("change", (e) => {
        const li = e.target.closest("li[data-id]");
        if (!li) return;
        const id = li.getAttribute("data-id");
        if (e.target.classList.contains("toggle")) toggle(id, e.target.checked);
      });

      load();
      render();
      input.focus();
    })();
  </script>
</body>
</html>























